---
title: "Tidyverse"
author: "**Milan Bhardwaj**, *Matr. Nr. 562289*"
---

# Challenge 1: Analyze the sales by location (state) with a bar plot.
```{r}
library(tidyverse)
library(readxl)
```

```{r}
# Import data
bikes_tbl <- read_excel(path = "/Users/milan/Documents/study/SEM4/BDSB/main/data/ds_data/01_bike_sales/01_raw_data/bikes.xlsx")
orderlines_tbl <- read_excel(path = "/Users/milan/Documents/study/SEM4/BDSB/main/data/ds_data/01_bike_sales/01_raw_data/orderlines.xlsx")
bikeshops_tbl <- read_excel(path = "/Users/milan/Documents/study/SEM4/BDSB/main/data/ds_data/01_bike_sales/01_raw_data/bikeshops.xlsx")
```

```{r}
# 4.0 Joining Data
bike_orderlines_joined_tbl <- orderlines_tbl %>%
  left_join(bikes_tbl, by = c("product.id" = "bike.id")) %>%
  left_join(bikeshops_tbl, by = c("customer.id" = "bikeshop.id"))
# bike_orderlines_joined_tbl %>% glimpse()

bike_orderlines_wrangled_tbl <- bike_orderlines_joined_tbl %>%
  
  separate(col = location, into = c("city", "state"), sep = ",") %>%
  mutate(total.price = price * quantity) %>%
  select(-...1, -gender) %>%
  select(-ends_with(".id")) %>%
  
  bind_cols(bike_orderlines_joined_tbl %>% select(order.id)) %>% 
  select(order.id, contains("order"), contains("model"), contains("category"),
         price, quantity, total.price,
         everything()) %>%
  rename(bikeshop = name) %>%
  set_names(names(.) %>% str_replace_all("\\.", "_"))

```

