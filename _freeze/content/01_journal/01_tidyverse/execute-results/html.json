{
  "hash": "a9a319a2e80eb6b20f99e247f12bbb95",
  "result": {
    "markdown": "---\ntitle: \"Tidyverse\"\nauthor: \"**Milan Bhardwaj**, *Matr. Nr. 562289*\"\n---\n\n\n# Challenge 1: Analyze the sales by location (state) with a bar plot.\n\n::: {.cell hash='01_tidyverse_cache/html/unnamed-chunk-1_750e46ef0eb64c0c55256db7e24969e4'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#> ✔ dplyr     1.1.2     ✔ readr     2.1.4\n#> ✔ forcats   1.0.0     ✔ stringr   1.5.0\n#> ✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n#> ✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n#> ✔ purrr     1.0.1     \n#> ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#> ✖ dplyr::filter() masks stats::filter()\n#> ✖ dplyr::lag()    masks stats::lag()\n#> ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(readxl)\n```\n:::\n\n::: {.cell hash='01_tidyverse_cache/html/unnamed-chunk-2_31bfcc84955eafb71067c60e28927bba'}\n\n```{.r .cell-code}\n# Import data\nbikes_tbl <- read_excel(path = \"/Users/milan/Documents/study/SEM4/BDSB/main/data/ds_data/01_bike_sales/01_raw_data/bikes.xlsx\")\norderlines_tbl <- read_excel(path = \"/Users/milan/Documents/study/SEM4/BDSB/main/data/ds_data/01_bike_sales/01_raw_data/orderlines.xlsx\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> New names:\n#> • `` -> `...1`\n```\n:::\n\n```{.r .cell-code}\nbikeshops_tbl <- read_excel(path = \"/Users/milan/Documents/study/SEM4/BDSB/main/data/ds_data/01_bike_sales/01_raw_data/bikeshops.xlsx\")\n```\n:::\n\n::: {.cell hash='01_tidyverse_cache/html/unnamed-chunk-3_caa19616f932f00604ae6d7eb6895ef9'}\n\n```{.r .cell-code}\n# 4.0 Joining Data\nbike_orderlines_joined_tbl <- orderlines_tbl %>%\n  left_join(bikes_tbl, by = c(\"product.id\" = \"bike.id\")) %>%\n  left_join(bikeshops_tbl, by = c(\"customer.id\" = \"bikeshop.id\"))\n# bike_orderlines_joined_tbl %>% glimpse()\n\nbike_orderlines_wrangled_tbl <- bike_orderlines_joined_tbl %>%\n  \n  separate(col = location, into = c(\"city\", \"state\"), sep = \",\") %>%\n  mutate(total.price = price * quantity) %>%\n  select(-...1, -gender) %>%\n  select(-ends_with(\".id\")) %>%\n  \n  bind_cols(bike_orderlines_joined_tbl %>% select(order.id)) %>% \n  select(order.id, contains(\"order\"), contains(\"model\"), contains(\"category\"),\n         price, quantity, total.price,\n         everything()) %>%\n  rename(bikeshop = name) %>%\n  set_names(names(.) %>% str_replace_all(\"\\\\.\", \"_\"))\n```\n:::\n\n::: {.cell hash='01_tidyverse_cache/html/unnamed-chunk-4_c653ad3a571f94d73a7d106671c899ea'}\n\n```{.r .cell-code}\n# Sales by location ----\nlibrary(lubridate)\nsales_by_loc <- bike_orderlines_wrangled_tbl %>%\n  \n  select(order_date, state, total_price) %>%\n  mutate(year = year(order_date)) %>%\n  group_by(state) %>% \n  summarize(sales = sum(total_price)) %>%\n  \n  mutate(sales_text = scales::dollar(sales, big.mark = \".\", decimal.mark = \",\", prefix = \"EUR \"))\n\nsales_by_loc\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"state\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"sales\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sales_text\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"Baden-Württemberg\",\"2\":\"6521090\",\"3\":\"EUR 6.521.090\"},{\"1\":\"Bavaria\",\"2\":\"6742819\",\"3\":\"EUR 6.742.819\"},{\"1\":\"Berlin\",\"2\":\"1128433\",\"3\":\"EUR 1.128.433\"},{\"1\":\"Bremen\",\"2\":\"10653499\",\"3\":\"EUR 10.653.499\"},{\"1\":\"Hamburg\",\"2\":\"3874756\",\"3\":\"EUR 3.874.756\"},{\"1\":\"Hesse\",\"2\":\"1558901\",\"3\":\"EUR 1.558.901\"},{\"1\":\"Lower Saxony\",\"2\":\"4107115\",\"3\":\"EUR 4.107.115\"},{\"1\":\"Mecklenburg-Western Pomerania\",\"2\":\"618974\",\"3\":\"EUR 618.974\"},{\"1\":\"North Rhine-Westphalia\",\"2\":\"21200613\",\"3\":\"EUR 21.200.613\"},{\"1\":\"Saxony\",\"2\":\"2230245\",\"3\":\"EUR 2.230.245\"},{\"1\":\"Saxony-Anhalt\",\"2\":\"569614\",\"3\":\"EUR 569.614\"},{\"1\":\"Schleswig-Holstein\",\"2\":\"3224749\",\"3\":\"EUR 3.224.749\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n# Step 2 - Visualize\n\n\n::: {.cell hash='01_tidyverse_cache/html/plot_67a11c09fe18103ff9934ec567ec8223'}\n\n```{.r .cell-code}\nsales_by_loc %>%\n  \n  ggplot(aes(x = state, y = sales)) +\n  \n  geom_col(fill = \"#354555\") + \n  geom_label(aes(label = sales_text)) + \n  geom_smooth(method = \"lm\", se = FALSE) + \n  \n  scale_y_continuous(labels = scales::dollar_format(big.mark = \".\", decimal.mark = \",\", prefix = \"EUR \")) +\n  labs(title = \"Revenue by location\", x = \"State\", y = \"Revenue\") + theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](01_tidyverse_files/figure-html/plot-1.png){width=768}\n:::\n:::\n\n::: {.cell hash='01_tidyverse_cache/html/unnamed-chunk-5_bf3f42dcca635b57a54e1c33111e94c6'}\n\n```{.r .cell-code}\n# Sales by Year and location \nsales_by_year_location_tbl <- bike_orderlines_wrangled_tbl %>%\n  select(order_date, total_price, state) %>%\n  mutate(year = year(order_date)) %>%\n  \n  group_by(year, state) %>%\n  summarise(sales = sum(total_price)) %>%\n  ungroup() %>%\n  \n  mutate(sales_text = scales::dollar(sales, big.mark = \".\", decimal.mark = \",\", prefix = \"EUR \"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `summarise()` has grouped output by 'year'. You can override using the\n#> `.groups` argument.\n```\n:::\n\n```{.r .cell-code}\nsales_by_year_location_tbl  \n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"year\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"state\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"sales\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sales_text\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"2015\",\"2\":\"Baden-Württemberg\",\"3\":\"1031924\",\"4\":\"EUR 1.031.924\"},{\"1\":\"2015\",\"2\":\"Bavaria\",\"3\":\"1301461\",\"4\":\"EUR 1.301.461\"},{\"1\":\"2015\",\"2\":\"Berlin\",\"3\":\"95853\",\"4\":\"EUR 95.853\"},{\"1\":\"2015\",\"2\":\"Bremen\",\"3\":\"1395912\",\"4\":\"EUR 1.395.912\"},{\"1\":\"2015\",\"2\":\"Hamburg\",\"3\":\"423090\",\"4\":\"EUR 423.090\"},{\"1\":\"2015\",\"2\":\"Hesse\",\"3\":\"308609\",\"4\":\"EUR 308.609\"},{\"1\":\"2015\",\"2\":\"Lower Saxony\",\"3\":\"584386\",\"4\":\"EUR 584.386\"},{\"1\":\"2015\",\"2\":\"Mecklenburg-Western Pomerania\",\"3\":\"222003\",\"4\":\"EUR 222.003\"},{\"1\":\"2015\",\"2\":\"North Rhine-Westphalia\",\"3\":\"3735092\",\"4\":\"EUR 3.735.092\"},{\"1\":\"2015\",\"2\":\"Saxony\",\"3\":\"238371\",\"4\":\"EUR 238.371\"},{\"1\":\"2015\",\"2\":\"Saxony-Anhalt\",\"3\":\"144737\",\"4\":\"EUR 144.737\"},{\"1\":\"2015\",\"2\":\"Schleswig-Holstein\",\"3\":\"448844\",\"4\":\"EUR 448.844\"},{\"1\":\"2016\",\"2\":\"Baden-Württemberg\",\"3\":\"1561658\",\"4\":\"EUR 1.561.658\"},{\"1\":\"2016\",\"2\":\"Bavaria\",\"3\":\"1129852\",\"4\":\"EUR 1.129.852\"},{\"1\":\"2016\",\"2\":\"Berlin\",\"3\":\"72361\",\"4\":\"EUR 72.361\"},{\"1\":\"2016\",\"2\":\"Bremen\",\"3\":\"2057760\",\"4\":\"EUR 2.057.760\"},{\"1\":\"2016\",\"2\":\"Hamburg\",\"3\":\"636550\",\"4\":\"EUR 636.550\"},{\"1\":\"2016\",\"2\":\"Hesse\",\"3\":\"225647\",\"4\":\"EUR 225.647\"},{\"1\":\"2016\",\"2\":\"Lower Saxony\",\"3\":\"639839\",\"4\":\"EUR 639.839\"},{\"1\":\"2016\",\"2\":\"Mecklenburg-Western Pomerania\",\"3\":\"75443\",\"4\":\"EUR 75.443\"},{\"1\":\"2016\",\"2\":\"North Rhine-Westphalia\",\"3\":\"3002792\",\"4\":\"EUR 3.002.792\"},{\"1\":\"2016\",\"2\":\"Saxony\",\"3\":\"589994\",\"4\":\"EUR 589.994\"},{\"1\":\"2016\",\"2\":\"Saxony-Anhalt\",\"3\":\"65901\",\"4\":\"EUR 65.901\"},{\"1\":\"2016\",\"2\":\"Schleswig-Holstein\",\"3\":\"672710\",\"4\":\"EUR 672.710\"},{\"1\":\"2017\",\"2\":\"Baden-Württemberg\",\"3\":\"1224152\",\"4\":\"EUR 1.224.152\"},{\"1\":\"2017\",\"2\":\"Bavaria\",\"3\":\"1411851\",\"4\":\"EUR 1.411.851\"},{\"1\":\"2017\",\"2\":\"Berlin\",\"3\":\"451293\",\"4\":\"EUR 451.293\"},{\"1\":\"2017\",\"2\":\"Bremen\",\"3\":\"2557145\",\"4\":\"EUR 2.557.145\"},{\"1\":\"2017\",\"2\":\"Hamburg\",\"3\":\"731678\",\"4\":\"EUR 731.678\"},{\"1\":\"2017\",\"2\":\"Hesse\",\"3\":\"338783\",\"4\":\"EUR 338.783\"},{\"1\":\"2017\",\"2\":\"Lower Saxony\",\"3\":\"1055747\",\"4\":\"EUR 1.055.747\"},{\"1\":\"2017\",\"2\":\"Mecklenburg-Western Pomerania\",\"3\":\"201218\",\"4\":\"EUR 201.218\"},{\"1\":\"2017\",\"2\":\"North Rhine-Westphalia\",\"3\":\"4671541\",\"4\":\"EUR 4.671.541\"},{\"1\":\"2017\",\"2\":\"Saxony\",\"3\":\"595378\",\"4\":\"EUR 595.378\"},{\"1\":\"2017\",\"2\":\"Saxony-Anhalt\",\"3\":\"194509\",\"4\":\"EUR 194.509\"},{\"1\":\"2017\",\"2\":\"Schleswig-Holstein\",\"3\":\"1076996\",\"4\":\"EUR 1.076.996\"},{\"1\":\"2018\",\"2\":\"Baden-Württemberg\",\"3\":\"1114327\",\"4\":\"EUR 1.114.327\"},{\"1\":\"2018\",\"2\":\"Bavaria\",\"3\":\"1168783\",\"4\":\"EUR 1.168.783\"},{\"1\":\"2018\",\"2\":\"Berlin\",\"3\":\"318974\",\"4\":\"EUR 318.974\"},{\"1\":\"2018\",\"2\":\"Bremen\",\"3\":\"1833844\",\"4\":\"EUR 1.833.844\"},{\"1\":\"2018\",\"2\":\"Hamburg\",\"3\":\"930803\",\"4\":\"EUR 930.803\"},{\"1\":\"2018\",\"2\":\"Hesse\",\"3\":\"330647\",\"4\":\"EUR 330.647\"},{\"1\":\"2018\",\"2\":\"Lower Saxony\",\"3\":\"929624\",\"4\":\"EUR 929.624\"},{\"1\":\"2018\",\"2\":\"Mecklenburg-Western Pomerania\",\"3\":\"21041\",\"4\":\"EUR 21.041\"},{\"1\":\"2018\",\"2\":\"North Rhine-Westphalia\",\"3\":\"4601681\",\"4\":\"EUR 4.601.681\"},{\"1\":\"2018\",\"2\":\"Saxony\",\"3\":\"338344\",\"4\":\"EUR 338.344\"},{\"1\":\"2018\",\"2\":\"Saxony-Anhalt\",\"3\":\"81163\",\"4\":\"EUR 81.163\"},{\"1\":\"2018\",\"2\":\"Schleswig-Holstein\",\"3\":\"572622\",\"4\":\"EUR 572.622\"},{\"1\":\"2019\",\"2\":\"Baden-Württemberg\",\"3\":\"1589029\",\"4\":\"EUR 1.589.029\"},{\"1\":\"2019\",\"2\":\"Bavaria\",\"3\":\"1730872\",\"4\":\"EUR 1.730.872\"},{\"1\":\"2019\",\"2\":\"Berlin\",\"3\":\"189952\",\"4\":\"EUR 189.952\"},{\"1\":\"2019\",\"2\":\"Bremen\",\"3\":\"2808838\",\"4\":\"EUR 2.808.838\"},{\"1\":\"2019\",\"2\":\"Hamburg\",\"3\":\"1152635\",\"4\":\"EUR 1.152.635\"},{\"1\":\"2019\",\"2\":\"Hesse\",\"3\":\"355215\",\"4\":\"EUR 355.215\"},{\"1\":\"2019\",\"2\":\"Lower Saxony\",\"3\":\"897519\",\"4\":\"EUR 897.519\"},{\"1\":\"2019\",\"2\":\"Mecklenburg-Western Pomerania\",\"3\":\"99269\",\"4\":\"EUR 99.269\"},{\"1\":\"2019\",\"2\":\"North Rhine-Westphalia\",\"3\":\"5189507\",\"4\":\"EUR 5.189.507\"},{\"1\":\"2019\",\"2\":\"Saxony\",\"3\":\"468158\",\"4\":\"EUR 468.158\"},{\"1\":\"2019\",\"2\":\"Saxony-Anhalt\",\"3\":\"83304\",\"4\":\"EUR 83.304\"},{\"1\":\"2019\",\"2\":\"Schleswig-Holstein\",\"3\":\"453577\",\"4\":\"EUR 453.577\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n## 2. Visualization- 12 Plots\n\n::: {.cell hash='01_tidyverse_cache/html/unnamed-chunk-6_9aa60aed0ac0135d1f6fcf638b60c4df'}\n\n```{.r .cell-code}\nsales_by_year_location_tbl %>%\n  ggplot(aes(x = year, y = sales, fill = state)) +\n  geom_col() +\n  facet_wrap(~ state) +\n  \n  scale_y_continuous(labels = scales::dollar_format(big.mark = \".\", decimal.mark = \",\", prefix = \"EUR \")) +\n  labs(\n    title = \"Revenue by year and state\",\n    fill = \"state\"\n  )+ theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](01_tidyverse_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}